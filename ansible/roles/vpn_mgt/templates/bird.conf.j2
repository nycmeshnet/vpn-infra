# Managed by ansible

# Configure logging
log syslog all;

router id {{ BIRD_ROUTER_ID }};

protocol device {
    scan time 10;
}

protocol direct {
    #disabled;              # Disable by default
    ipv4;                   # Connect to default IPv4 table
    #ipv6;                   # ... and to default IPv6 table
}

protocol kernel {
    persist;
    scan time 10;
    ipv4 {                  # Connect protocol to IPv4 table by channel
#        table master4;    # Default IPv4 table is master4
        import all;   # Import to table, default is import all
        export all;   # Export to protocol. default is export none
    };
####    learn;                  # Learn alien routes from the kernel
#       kernel table 10;        # Kernel table to synchronize with (default: main)
}

protocol static {
    ipv4;                   # Again, IPv4 channel with default options
}

protocol ospf v2 {
    ipv4 {
        ####import none;
        import all;
    };
    area 0 {
        default cost 10;
        networks {
            {% for bird_net in BIRD_NETWORKS.split(';') %}
            {{ bird_net }};
            {% endfor %}
        };
        interface "eth*" {
            type broadcast; # Detected by default
            cost 10;                # Interface metric
        };
        interface "dummy*" {
            cost 10;
        };
        {% for wg_config in wireguard_configs %}
        {% if wg_config.NEIGHBORS is defined %}
        interface "wg{{ wg_config.NAME }}" {
            cost {{ wg_config.COST | default(100) }};
            tx length {{ wg_config.TX_LENGTH | default(1420) }};
            type ptmp;
            neighbors {
                {{ wg_config.NEIGHBORS }};
            };
        };
        {% endif %}
        {% endfor %}
    };
}
